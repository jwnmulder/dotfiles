#!/bin/sh

yadm_bin=~/.local/bin/yadm
[ ! -f $yadm_bin ] && yadm_bin=yadm

# Because Git submodule commands cannot operate without a work tree, they must
# be run from within $HOME (assuming this is the root of your dotfiles)
cd "$HOME"

echo "Init submodules"
yadm submodule update --recursive --init

# sparse checkout
$yadm_bin gitconfig core.sparseCheckout true

cat << EOF > "$HOME/.local/share/yadm/repo.git/info/sparse-checkout"
# generated by $0
/*
!README.md
EOF

# yadm reset as otherwise 'yadm status' will show a lot of deleted files
$yadm_bin reset

# yadm checkout to activate the sparseCheckout config above
$yadm_bin checkout --quiet
